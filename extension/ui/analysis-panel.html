<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WebMCP - é¡µé¢åˆ†æ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f9fafb;
      padding: 20px;
      min-width: 400px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .header h1 {
      font-size: 20px;
      color: #111827;
      margin-bottom: 8px;
    }

    .header .url {
      font-size: 14px;
      color: #6b7280;
      word-break: break-all;
    }

    .section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 16px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #22c55e;
      color: white;
    }

    .btn-primary:hover {
      background: #16a34a;
    }

    .btn-primary:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #d1d5db;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .status {
      padding: 12px;
      border-radius: 6px;
      font-size: 14px;
      margin-bottom: 16px;
    }

    .status-info {
      background: #dbeafe;
      color: #1e40af;
    }

    .status-success {
      background: #dcfce7;
      color: #166534;
    }

    .status-error {
      background: #fee2e2;
      color: #991b1b;
    }

    .status-warning {
      background: #fef3c7;
      color: #92400e;
    }

    .tool-card {
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      transition: all 0.2s;
      cursor: pointer;
    }

    .tool-card:hover {
      border-color: #22c55e;
      background: #f9fafb;
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .tool-card.active {
      border-color: #22c55e;
      background: #f0fdf4;
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.2);
    }

    .tool-card.approved {
      border-color: #22c55e;
      background: #f0fdf4;
      opacity: 0.8;
    }

    .tool-card.approved::after {
      content: 'âœ“ å·²æ‰¹å‡†';
      position: absolute;
      top: 8px;
      right: 8px;
      background: #22c55e;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }

    .tool-card.rejected {
      border-color: #ef4444;
      background: #fef2f2;
      opacity: 0.6;
    }

    .tool-card.rejected::after {
      content: 'âœ— å·²æ‹’ç»';
      position: absolute;
      top: 8px;
      right: 8px;
      background: #ef4444;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }

    .tool-card {
      position: relative;
    }

    .tool-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 12px;
    }

    .tool-name {
      font-size: 16px;
      font-weight: 600;
      color: #111827;
      font-family: monospace;
    }

    .tool-confidence {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      background: #f3f4f6;
      color: #6b7280;
    }

    .tool-confidence.high {
      background: #dcfce7;
      color: #166534;
    }

    .tool-description {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 12px;
    }

    .tool-elements {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 12px;
    }

    .tool-elements code {
      background: #f3f4f6;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
      margin-right: 4px;
    }

    .tool-actions {
      display: flex;
      gap: 8px;
    }

    .tool-actions .btn {
      flex: 1;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
    }

    .tool-actions .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .feedback-box {
      margin-top: 12px;
      display: none;
    }

    .feedback-box.show {
      display: block;
    }

    .feedback-box textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      min-height: 60px;
    }

    .feedback-box .btn {
      margin-top: 8px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #6b7280;
    }

    .spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #22c55e;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .empty {
      text-align: center;
      padding: 40px;
      color: #9ca3af;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .stat-item {
      text-align: center;
      padding: 12px;
      background: #f9fafb;
      border-radius: 6px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 600;
      color: #111827;
    }

    .stat-label {
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
    }

    .hidden {
      display: none;
    }

    /* AI è°ƒè¯•ä¿¡æ¯æ ·å¼ */
    .ai-debug-box {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 12px;
    }

    .ai-debug-label {
      font-size: 13px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
    }

    .ai-debug-content {
      font-size: 12px;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      color: #6b7280;
      background: white;
      padding: 10px;
      border-radius: 4px;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-word;
      line-height: 1.5;
    }

    .ai-debug-content.loading {
      color: #9ca3af;
      font-style: italic;
    }

    .ai-debug-content.success {
      color: #059669;
    }

    .ai-debug-content.error {
      color: #dc2626;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- é¡µé¢ä¿¡æ¯ -->
    <div class="header">
      <h1 id="pageTitle">é¡µé¢åˆ†æ</h1>
      <div class="url" id="pageUrl"></div>
    </div>

    <!-- å¼€å§‹åˆ†æ -->
    <div id="startSection" class="section">
      <div class="section-title">æ™ºèƒ½é€‚é…å™¨ç”Ÿæˆ</div>
      <p style="color: #6b7280; margin-bottom: 16px; font-size: 14px;">
        ç‚¹å‡»"å¼€å§‹åˆ†æ"ï¼ŒAI å°†è‡ªåŠ¨åˆ†æé¡µé¢ç»“æ„ï¼Œè¯†åˆ«å¸¸ç”¨æ“ä½œï¼Œå¹¶ç”Ÿæˆä¸“ç”¨å·¥å…·ã€‚
      </p>
      <button id="btnStartAnalysis" class="btn btn-primary">
        ğŸ” å¼€å§‹åˆ†æ
      </button>
    </div>

    <!-- åˆ†æä¸­ -->
    <div id="analyzingSection" class="section hidden">
      <div class="loading">
        <div class="spinner"></div>
        <div id="analyzingStatus">æ­£åœ¨åˆ†æé¡µé¢...</div>
      </div>
      
      <!-- AI è¯·æ±‚/å“åº”å±•ç¤º -->
      <div id="aiDebugSection" class="hidden" style="margin-top: 20px;">
        <div class="section-title" style="font-size: 14px; margin-bottom: 12px;">AI åˆ†æè¿‡ç¨‹</div>
        
        <!-- AI è¯·æ±‚ -->
        <div class="ai-debug-box">
          <div class="ai-debug-label">ğŸ“¤ å‘é€ç»™ AIï¼š</div>
          <div class="ai-debug-content" id="aiRequest">ç­‰å¾…ä¸­...</div>
        </div>
        
        <!-- AI å“åº” -->
        <div class="ai-debug-box" style="margin-top: 12px;">
          <div class="ai-debug-label">ğŸ“¥ AI è¿”å›ï¼š</div>
          <div class="ai-debug-content" id="aiResponse">ç­‰å¾…ä¸­...</div>
        </div>
      </div>
    </div>

    <!-- åˆ†æç»“æœ -->
    <div id="resultsSection" class="section hidden">
      <div class="section-title">åˆ†æç»“æœ</div>
      
      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <div class="stats">
        <div class="stat-item">
          <div class="stat-value" id="statElements">0</div>
          <div class="stat-label">äº¤äº’å…ƒç´ </div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="statTools">0</div>
          <div class="stat-label">ç”Ÿæˆå·¥å…·</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="statConfidence">0%</div>
          <div class="stat-label">å¹³å‡ç½®ä¿¡åº¦</div>
        </div>
      </div>

      <!-- çŠ¶æ€æç¤º -->
      <div id="statusMessage" class="status status-info hidden"></div>

      <!-- å·¥å…·åˆ—è¡¨ -->
      <div id="toolsList"></div>

      <!-- å®ŒæˆæŒ‰é’® -->
      <div id="completeSection" class="hidden">
        <button id="btnComplete" class="btn btn-primary" style="width: 100%;">
          âœ“ ä¿å­˜é€‚é…å™¨
        </button>
      </div>
    </div>

    <!-- é”™è¯¯ä¿¡æ¯ -->
    <div id="errorSection" class="section hidden">
      <div class="status status-error" id="errorMessage"></div>
      <button id="btnRetry" class="btn btn-secondary">é‡è¯•</button>
    </div>
  </div>

  <script src="../analyzer/tool-generator.js"></script>
  <script src="../analyzer/tool-executor.js"></script>
  <script src="analysis-panel.js"></script>
</body>
</html>
